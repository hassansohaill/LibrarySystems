@page "/OverdueDefault"

<NavBar />



    <div class="overdueContainer">
    @if (fees == 0)
    {

        <p style="font-size: 18px;">You have no outstanding fees. You can continue browse items by returning <a href="/">Home</a>.</p>
    }
    else
    {
        <body>
            <h1 class="overduesign">OVERDUE FEES</h1>
            <h1>Total Fees Due: $@feeOutput </h1>
            <button class="btn btn-danger" @onclick="(() => payAllTogglePopup())"> Pay All </button>
        </body>

        @if (showAllPopup)
        {
            @if (savedPayment)
            {
                <div style="position: absolute; top: 68px; left: 50%;top:50% ;transform: translate(-50%,-50%); width: 700px; height: 700px; background-color: #e8f4f8; overflow: auto; opacity: 1; box-shadow: 0 0 10px rgba(0, 0, 0, 0.35); text-align: center;overflow: hidden;">
                    <button @onclick="payAllTogglePopup" class="toggle" type="button" style=" display: block; margin:  1% 1% 20px auto;background-color: transparent;background: #03549a;width: 40px;height: 40px;cursor: pointer;font-size: 25px;border-radius: 100%;"> &times  </button>

                    <button class="btn btn-danger" style="top: 90%; position:fixed;transform: translateX(-50%); " @onclick="(() => RemoveAll())"> Finalize Payment </button>
                </div>
            }
            else
            {
                <div style="position: absolute; top: 68px; left: 50%;top:50% ;transform: translate(-50%,-50%); width: 700px; height: 700px; background-color: #e8f4f8; overflow: auto; opacity: 1; box-shadow: 0 0 10px rgba(0, 0, 0, 0.35); text-align: center;overflow: hidden;">
                    <button @onclick="payAllTogglePopup" class="toggle" type="button" style=" display: block; margin:  1% 1% 20px auto;background-color: transparent;background: #03549a;width: 40px;height: 40px;cursor: pointer;font-size: 25px;border-radius: 100%;"> &times  </button>
                    <p>Payment</p>
                    <p>Payment</p>
                    <button class="btn btn-danger" style="top: 90%; position:fixed;transform: translateX(-50%); " @onclick="(() => RemoveAll())"> Finalize Payment </button>
                </div>
            }

        }
    }
    </div>



<div class="container">
    <div class="row">
        <div class="col-lg-11">
            <table class="table">
                <tbody>

                    @foreach (var str in ListOverdue.StringsOverdue)
                    {
                        @foreach (var book in bookDictionary[str])
                        {

                            <tr class="hold-item">
                                <td>
                                    <img src="@book.Image" alt="Book Cover" height="120" />
                                </td>
                                <td class="book-details">
                                    <b><p style="font-size:larger">@book.Title</p></b>
                                    <p>by @book.Author</p>
                                    @if (@book.Type == "paper")
                                    {
                                        <div style="color:black;">
                                            <i class="fas fa-book"></i> Book
                                        </div>
                                    }
                                    else
                                    {
                                        <div style="color:black; ">
                                            <i class="fas fa-tablet-alt"></i> eBook
                                        </div>
                                    }
                                </td>
                                <td>
                                    <p><b>Due date:</b> @book.DueDate,</p>
                                    <p><b>Days overdue:</b> @book.DaysDue</p>
                                </td>
                                <td>
                                    <p></p>
                                    <p><b>Cost:</b> $@book.Cost</p>
                                </td>
                                <td>
                                    <button class="btn btn-danger" @onclick="(() => TogglePopup(book.Author, book.Title, book.Cost, book.Type, book.DaysDue, book.Status, book))"> Pay </button>
                                    @if (showPopup)
                                    {
                                        <div style="position: absolute; top: 68px; left: 50%;top:50% ;transform: translate(-50%,-50%); width: 700px; height: 700px; background-color: #e8f4f8; overflow: auto; opacity: 1; box-shadow: 0 0 10px rgba(0, 0, 0, 0.35); text-align: center;overflow: hidden;">
                                            <button @onclick="Toggleclose" class="toggle" type="button" style=" display: block; margin:  1% 1% 20px auto;background-color: transparent;background: #03549a;width: 40px;height: 40px;cursor: pointer;font-size: 25px;border-radius: 100%;"> &times  </button>
                                            <p>Payment</p>
                                            <p>Payment</p><p>Payment</p>
                                            <p>Payment</p>
                                            <button class="btn btn-danger" style="top: 90%; position:fixed;transform: translateX(-50%); " @onclick="(() => RemoveBook(popupTitle,selected))"> Finalize Payment </button>
                                        </div>
                                    }

                                </td>.

                            </tr>
                        }

                    }


                </tbody>
            </table>
        </div>
        <div class="col-lg-1"></div>
    </div>
</div>


<style>
    .popup button {
        display: block;
        margin: 0 0 20px auto;
        background-color: transparent;
        font-size: 30px;
        color: #ffffff;
        background: #03549a;
        border-radius: 100%;
        width: 40px;
        height: 40px;
        border: none;
        outline: none;
        cursor: pointer;
    }

    .paymentPopup {
        width: 420px;
        padding: 30px 40px;
        position: = fixed;
        transform: translate(-50%,-50%);
        left: 50%;
        top: 50%;
        border-radius: 8px;
        display: none;
        font-family: “Poppins”,sans-serif;
        text-align: center;
        background-color: #0855ae;
    }

    .overdueContainer {
        text-align: center;
        margin-top: 50px;
    }

    .paynow {
        margin-left: 10px;
        display: inline-block;
    }

    .container {
        margin-top: 100px;
    }
</style>

@code {

    public class Book
    {
        public string Author { get; set; }
        public string Title { get; set; }
        public string Category { get; set; }
        public string Status { get; set; }
        public string Image { get; set; }
        public string Type { get; set; }
        public int num { get; set; }
        public string Description { get; set; }
        public string Location { get; set; }
        public string Pickup { get; set; }
        public string Holding { get; set; }

        public string DueDate { get; set; }
        public string DaysDue { get; set; }
        public string Cost { get; set; }

    }

    private List<Book> books = new List<Book>()
{
            new Book() { Author = "Lauren Westwood", Title = "My Secret Sister", DueDate ="03/21/2023", Category = "Popular" ,Status = "Available", num = 2 , Image = "images/Book2.png", Type = "paper", Location = "Foxtowne", Pickup = "Waitlist Pos 3", Holding = "N/A", Cost = "2.57", DaysDue = "20 days", Description = "“I can’t imagine not having a sister— not having you.”\n\nWe both know it’s a lie. So many times, I’ve had to imagine it. What will it be like to see her lying there, her body empty, her spirit gone?\n\nI take her hand and squeeze it hard. “Are you scared?” I say.\n\n“Yeah… I am.”\n\nMY SECRET SISTER\n\nTwo women, two secret heartbreaks…\n\nSan Francisco – Claire is living every mother’s worst nightmare. Her daughter, Jess, is suffering from a rare illness and desperately needs a bone marrow transplant. In a race against time, Claire will do anything to find the match that will save her daughter’s life.\n\nWashington D.C. – Marianne has suffered a heartbreaking string of miscarriages and IVF failures. With her perfect life crumbling around her, she will do whatever it takes to become a mother.\n\nTwo DNA tests...\n\nWhen the results of a DNA test show an unexpected relationship between Claire and Marianne, Claire must confront the darkest secrets of her past and make an impossible choice about the future.\n\nOne big lie...\n\nIs Claire’s secret sister the answer to her prayers?\n\nOr will she cost her everything?\n\nA powerful and emotional page-turner about motherhood, family secrets, and the choices a mother faces to keep her children safe. Perfect for fans of Liane Moriarty, Jojo Moyes, and Jodi Picoult." },
            new Book() { Author = "Lori Lacefield", Title = "The Fifth Juror", Category = "Popular",Status =  "Available", num = 3 , Image = "images/Book3.png", Type = "paper", Location = "Foxtowne",Pickup = "Waitlist Pos 2", Holding = "N/A", Cost = "0.75", DaysDue ="5 days", DueDate ="04/05/2023",  Description = "Former juror Jess Dawson is facing a difficult time in her life, raising an autistic son and navigating a failing marriage, when her past service as a juror on a high-profile death penalty case comes back to haunt her. Mikael Kriskan, a young Russian the jury sentenced to death for killing his adoptive American parents one cold Colorado night, is nearing his execution date when the foreman of their jury and his wife are found dead, killed in the same manner as Kriskan’s parents.\n\nThen, a second juror appears to commit suicide and leaves a disturbing note to his fellow jurors attached to his chest: KJ - do the right thing. Only Jess knows the true meaning of the message but as others begin to suspect the truth, Jess quickly finds herself in the crosshairs of Kriskan’s prosecutor, also her lover, who’s intent on executing Kriskan, and members of the Russian mob, who are hell bent on returning the genius Kriskan to his Russian roots.\n\nThe choice they give former juror Jess Dawson seems easy: Kill Mikael, kill her son. Save Mikael, save her son. But in a case where the post-conviction appeals have run out, the impact the truth will have upon her family is dire, and the lives of her fellow jurors are equally at stake—this choice will be anything but easy.\n\nThe Fifth Juror is the second nail-biting suspense thriller in the Women of Redemption Series, books that feature women who may not be perfect, but perfectly kick-ass when given a second chance.\n\nIf you like strong female heroines, titanic twists, and danger around every corner, you’ll love this edge-of-your-seat read! For fans of John Grisham, L.T. Ryan’s Rachel Hatch, and James Patterson’s fast paced plots."},
            new Book() { Author = "Peter Attied, MD", Title = "Outlive", DueDate ="03/01/2023", Category = "New Releases" , Status = "Available" , num = 9 , Image = "images/Book9.png", Type = "paper", Location = "Foxtowne", Pickup = "Waitlist Pos 8",  Holding = "N/A", Cost = "4.58", DaysDue = "40 days", Description = "Wouldn’t you like to live longer? And better? In this operating manual for longevity, Dr. Peter Attia draws on the latest science to deliver innovative nutritional interventions, techniques for optimizing exercise and sleep, and tools for addressing emotional and mental health.\n \nFor all its successes, mainstream medicine has failed to make much progress against the diseases of aging that kill most people: heart disease, cancer, Alzheimer’s disease, and type 2 diabetes. Too often, it intervenes with treatments too late to help, prolonging lifespan at the expense of healthspan, or quality of life. Dr. Attia believes we must replace this outdated framework with a personalized, proactive strategy for longevity, one where we take action now, rather than waiting.\n \nThis is not “biohacking,” it’s science: a well-founded strategic and tactical approach to extending lifespan while also improving our physical, cognitive, and emotional health. Dr. Attia’s aim is less to tell you what to do and more to help you learn how to think about long-term health, in order to create the best plan for you as an individual. In Outlive, readers will discover:\n \n• Why the cholesterol test at your annual physical doesn’t tell you enough about your actual risk of dying from a heart attack.\n• That you may already suffer from an extremely common yet underdiagnosed liver condition that could be a precursor to the chronic diseases of aging.\n• Why exercise is the most potent pro-longevity “drug”—and how to begin training for the “Centenarian Decathlon.”\n• Why you should forget about diets, and focus instead on nutritional biochemistry, using technology and data to personalize your eating pattern.\n• Why striving for physical health and longevity, but ignoring emotional health, could be the ultimate curse of all.\n \nAging and longevity are far more malleable than we think; our fate is not set in stone. With the right roadmap, you can plot a different path for your life, one that lets you outlive your genes to make each decade better than the one before."},

    };

    private Dictionary<string, List<Book>> bookDictionary;

    protected override void OnInitialized()
    {
        calculateFee();
        precision();
        bookDictionary = books.GroupBy(b => b.Title)
            .ToDictionary(g => g.Key, g => g.ToList());
    }


    double fees = 0;
    string feeOutput = "";

    private void calculateFee()
    {
        fees = 0;
        foreach (var book in books)
        {
            double intCost = double.Parse(book.Cost);
            fees += intCost;
        }
    }
    private void precision()
    {
        feeOutput = fees.ToString("F2");
    }

    private void RemoveBook(string title,Book selected)
    {
        ListOverdue.StringsOverdue.Remove(title);
        books.Remove(selected);
        Toggleclose();
        calculateFee();
        precision();
    }


    bool savedPayment = false;
    bool showPopup = false;
    bool showAllPopup = false;
    string popupAuthor;
    string popupTitle;
    string popupCost;
    string popupDueDays;
    string popupType;
    string popupDate;
    Book selected;
    bool showFullText = false;

    void TogglePopup(string author, string title, string cost, string type, string days, string dueDate, Book selectBook)
    {
        showPopup = !showPopup;
        popupAuthor = author;
        popupTitle = title;
        popupCost = cost;
        popupDueDays = days;
        popupType = type;
        popupDate = dueDate;
        selected = selectBook;
    }

    void RemoveAll()
    {
        ListOverdue.StringsOverdue.Clear();
        books.Clear();
        payAllTogglePopup();
        calculateFee();
        precision();
    }

    void payAllTogglePopup()
    {
        showAllPopup = !showAllPopup;
    }

    void Toggleclose()
    {
        showPopup = !showPopup;
    }


}
